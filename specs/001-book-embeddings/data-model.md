# Data Model: Book Embeddings and Vector Storage

**Feature**: Book Embeddings and Vector Storage
**Date**: 2025-12-27
**Modeler**: Claude

## Overview

Data model for the ingestion pipeline that processes book content, generates embeddings, and stores them in Qdrant Cloud for RAG-based retrieval.

## Entity Definitions

### TextChunk

**Description**: A segment of extracted book content that has been cleaned and prepared for embedding generation

**Fields**:
- `id` (str): Unique identifier for the chunk (UUID)
- `content` (str): The actual text content of the chunk
- `source_url` (str): The URL where this content was extracted from
- `chunk_index` (int): The sequential position of this chunk within the source document
- `created_at` (datetime): Timestamp when the chunk was created
- `word_count` (int): Number of words in the content
- `char_count` (int): Number of characters in the content
- `metadata` (dict): Additional metadata about the chunk

**Validation Rules**:
- `content` must not be empty
- `content` length must be between 100 and 2000 characters
- `source_url` must be a valid URL format
- `chunk_index` must be non-negative

### EmbeddingVector

**Description**: A high-dimensional numerical representation of text content generated by Cohere models

**Fields**:
- `id` (str): Unique identifier for the embedding (matches TextChunk.id)
- `vector` (list[float]): The embedding vector values
- `text_chunk_id` (str): Reference to the source TextChunk
- `model_name` (str): The name of the model used for embedding
- `created_at` (datetime): Timestamp when the embedding was generated
- `dimension` (int): The dimensionality of the embedding vector

**Validation Rules**:
- `vector` must not be empty
- `vector` must have consistent dimensionality (typically 1024 for Cohere models)
- `text_chunk_id` must reference an existing TextChunk
- `dimension` must match the expected model output

### BookURL

**Description**: A publicly accessible URL from the deployed Docusaurus book site that contains content to be processed

**Fields**:
- `url` (str): The full URL to be processed
- `status` (str): Processing status (pending, processing, completed, failed)
- `title` (str): The title of the page (extracted from HTML)
- `last_crawled_at` (datetime): Timestamp of last crawl attempt
- `crawl_attempts` (int): Number of times this URL has been crawled
- `error_message` (str): Any error message from the last crawl attempt (if failed)

**Validation Rules**:
- `url` must be a valid URL format
- `status` must be one of: pending, processing, completed, failed
- `crawl_attempts` must be non-negative

### ProcessingMetadata

**Description**: Information about each text chunk including source URL, position in document, and processing timestamps

**Fields**:
- `text_chunk_id` (str): Reference to the TextChunk
- `source_url` (str): The original URL where content was found
- `document_title` (str): Title of the source document
- `section_path` (str): Path of the section in the book hierarchy
- `processing_started_at` (datetime): When processing began
- `processing_completed_at` (datetime): When processing completed
- `embedding_generated` (bool): Whether an embedding was successfully generated
- `additional_metadata` (dict): Any additional metadata specific to the content

**Validation Rules**:
- `text_chunk_id` must reference an existing TextChunk
- `processing_completed_at` must be after `processing_started_at` if both present
- `source_url` must be a valid URL format

## Relationships

```
BookURL --(1 to many)--> TextChunk
TextChunk --(1 to 1)--> EmbeddingVector
TextChunk --(1 to 1)--> ProcessingMetadata
```

## State Transitions

### BookURL Status Transitions
- `pending` → `processing`: When crawl begins
- `processing` → `completed`: When content extraction succeeds
- `processing` → `failed`: When crawl or extraction fails
- `failed` → `pending`: When retry is initiated

### Embedding Generation Process
1. TextChunk is created from extracted content
2. EmbeddingVector is created with the generated embedding
3. ProcessingMetadata is updated with completion status

## Qdrant Collection Schema

The Qdrant collection will be structured as follows:

**Collection Name**: `book_embeddings`

**Payload Schema**:
```json
{
  "text_chunk_id": "string",
  "content": "string",
  "source_url": "string",
  "document_title": "string",
  "section_path": "string",
  "created_at": "datetime",
  "additional_metadata": "json_object"
}
```

**Vector Configuration**:
- Size: 1024 (for Cohere embeddings)
- Distance: Cosine (for semantic similarity)

## Indexing Strategy

- Primary index on `text_chunk_id` for fast retrieval
- Secondary index on `source_url` for content grouping
- Secondary index on `document_title` for document-level queries